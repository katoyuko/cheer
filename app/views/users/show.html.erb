<%= render "layouts/flash" %>

<div class="row">
  <div class="col-md-10 col-md-offset-1 tab-content">
    <!-- タブメニュー -->
    <ul class="nav nav-tabs nav-justified">
      <li role="mypage" class="active">
        <a href="#user-info" data-toggle="tab">
          <h3>My info</h3><br><p class="small-title">登録情報</p>
        </a>
      </li>
      <li role="mypage">
        <a href="#all-post" data-toggle="tab">
          <h3>All posts</h3><br><p class="small-title">投稿一覧</p>
        </a>
      </li>
      <li role="mypage">
        <a href="#fav-category" data-toggle="tab">
          <h3>Favorite category</h3><br><p class="small-title">お気に入りカテゴリ</p>
        </a>
      </li>
      <li role="mypage">
        <a href="#chart" data-toggle="tab">
          <h3>My chart</h3><br><p class="small-title">頑張りチャート</p>
        </a>
      </li>
    </ul>

    <!-- タブコンテンツ -->
    <div class="tab-content">
      <div class="tab-pane active" id="user-info">
        <%= render "users/user_info" %>
      </div>

      <div class="tab-pane" id="all-post">
        <%= render "users/user_posts" %>
      </div>

      <div class="tab-pane" id="fav-category">
        <%= render "users/user_fav" %>
      </div>

      <div class="tab-pane" id="chart">
        <p class="chart">[ 月別投稿件数 <%= fa_icon("pencil") %> ]</p>
        <%= column_chart @chart_data,
          colors: ["#76d9cd"],
          suffix: "件",
          messages: {empty: "投稿がありません"}
         %>
      </div>
    </div>

  </div>
</div>



<script type="text/javascript">
$(function() {
  // イベント名 ajax:success レスポンスが成功時、発火
  $(document).on("ajax:success", ".cheer-button", function(event) {
    let currentNo;
    let $cheerFlag_i = $(this).children().children('i')
    let $cheerFlag_span = $(this).children().children('span')

    // fa-flagクラスをもっているか判定
    // かつ、どのpost.idがclickされか判断
    if ($cheerFlag_i.hasClass('fa-flag-o')){
      $cheerFlag_i.removeClass('fa-flag-o').addClass('fa-flag');
      currentNo = $cheerFlag_span.html();
      $cheerFlag_span.html(Number(currentNo) + 1);
      $(this).attr("data-method", "delete");
    } else {
      $cheerFlag_i.removeClass('fa-flag').addClass('fa-flag-o');
      currentNo = $cheerFlag_span.html();
      $cheerFlag_span.html(Number(currentNo) - 1);
      $(this).attr("data-method", "post");
    }
  })
});


// <!-- ツールチップ
$(function () {
  $('[data-toggle="tooltip"]').tooltip();
});

</script>

